Day One:
    Initiate App:
        django-admin startproject coffee_stained_map
        cd coffee_stained_map
        python manage.py startapp cafes

        -Added app to settings/installed_apps

    Setting Up Postgres:
        psql -U cianan
        CREATE DATABASE coffee_stained_map;
        \c coffee_stained_map
        CREATE EXTENSION postgis;

        -Added db info to settings.py

    -Creating a cafe model

    -Importing data from cafes.csv
        import csv
        from cafes.models import Cafe
        from django.contrib.gis.geos import Point

        with open('cafes.csv', newline='', encoding='utf-8') as csvfile:
            reader = csv.DictReader(csvfile)
            for row in reader:
                name = row['name']
                address = row['address']
                lon = float(row['longitude'])
                lat = float(row['latitude'])
                rating = float(row['rating'])
                location = Point(lon, lat)
                
                Cafe.objects.create(
                    name=name,
                    address=address,
                    location=location,
                    rating=rating
                )

import csv
from cafes.models import Cafe
from django.contrib.gis.geos import Point

with open('data/cafes.csv', newline='', encoding='utf-8') as csvfile:
    reader = csv.reader(csvfile)
    next(reader)  # skip the header row
    for row in reader:
        name, address, lon, lat, rating = row
        Cafe.objects.create(
            name=name,
            address=address,
            location=Point(float(lon), float(lat)),
            rating=float(rating)
        )

print("Sample cafes loaded!")

model hadnt properly migrated:  
    python manage.py makemigrations cafes
    python manage.py migrate

    verify:
        python manage.py shell
        from cafes.models import Cafe
        Cafe.objects.all() 

        it worked!

re-tried:
    import csv
    from cafes.models import Cafe
    from django.contrib.gis.geos import Point

    with open('data/cafes.csv', newline='', encoding='utf-8') as csvfile:
        reader = csv.reader(csvfile)
        next(reader)  # skip the header row
        for row in reader:
            name, address, lon, lat, rating = row
            Cafe.objects.create(
                name=name,
                address=address,
                location=Point(float(lon), float(lat)),
                rating=float(rating)
            )


    SAMPLE CAFE LOADED!

    verify data:    
        from cafes.models import Cafe
        from django.contrib.gis.geos import Point
        from django.contrib.gis.db.models.functions import Distance

        my_location = Point(-6.26, 53.34, srid=4326)

        nearby_cafes = (
            Cafe.objects
            .annotate(distance=Distance('location', my_location))
            .order_by('distance')
        )

        for cafe in nearby_cafes:
            print(cafe.name, cafe.distance.m)  # distance in meters


Configuring Rest Framework: 
    Adding to settings.py -> output will be geojson not json

Created serializer in cafes:
    converts python object into geojson structure

Created a view:
    readonly access for api endpoint. lets you read all cafes

Made cafe/urls.py:
    Django project has 2 levels of url routing - project/urls and app/urls
    Project one is first entry Point for when a web request comes in, deciding which app should handle it.
    Then each app has urls, which connects to specific urls within the app.

Run server:
    python manage.py runserver

    had issues with render. removed line from settings.py and it worked :)

    SUCCESS!

Now im going to try the cafes on a map using leaflet:
    making templates folder. creating maps.html
    creating static folder

Having issues with markers. geojson parsing wrong. cant understand why tbh.
had issue with urls.



Okay I had to change my structure to have all the js/css/template into one file for now as I was facing massive bugs. I may try to sepearate them again later.

I am going to try working on queries now.

    python manage.py shell  

    test get all cafes within 500m:
        from cafes.models import Cafe
        from django.contrib.gis.geos import Point
        from django.contrib.gis.db.models.functions import Distance

        # Reference point (example: Brew Hub)
        brew_hub = Cafe.objects.get(name="Brew Hub")
        buffer_distance = 500  # in meters

        # Get all cafÃ©s within 500m
        nearby_cafes = Cafe.objects.filter(
            location__distance_lte=(brew_hub.location, buffer_distance)
        )

        for cafe in nearby_cafes:
            print(cafe.name, cafe.location)

    making api for it:
        adding cafes near function to views

        had issues with views.py -> nearby = Cafe.objects.filter(location__distance_lte=(ref_point, D(m=distance)))
        for ages as I missed the double underscore!!!

        http://127.0.0.1:8000/api/nearby/?lat=53.334&lng=-6.264&distance=500

        returns:
        {"type":"FeatureCollection","features":[{"id":1,"type":"Feature","geometry":"SRID=4326;POINT (-6.264209 53.334211)","properties":{"name":"Brew Hub","address":"95 Some Street, Dublin","rating":4.8}},{"id":3,"type":"Feature","geometry":"SRID=4326;POINT (-6.26192 53.33741)","properties":{"name":"Bean Spot","address":"87 Some Street, Dublin","rating":3.2}},{"id":9,"type":"Feature","geometry":"SRID=4326;POINT (-6.257994 53.332188)","properties":{"name":"Bean Lounge","address":"7 Some Street, Dublin","rating":3.2}},{"id":24,"type":"Feature","geometry":"SRID=4326;POINT (-6.257863 53.333415)","properties":{"name":"Espresso Lounge","address":"24 Some Street, Dublin","rating":4.0}}]}

        