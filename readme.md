# Coffee Stained Map

Interactive Location-Based Café Explorer
(Django, PostGIS, Leaflet, Overpass API)

Coffee Stained Map is an interactive geospatial web application that allows users to explore cafés across Ireland. The system provides county filtering, radius searches, nearest-café queries, live GPS tracking, user favourites stored locally, routes between points, and a feature to discover nearby libraries using OpenStreetMap’s Overpass API.

This project was developed as part of the TU Dublin Advanced Web Mapping module (CA2).

The application is publicly deployed and accessible at:

**[https://webmapping-assignment.onrender.com](https://webmapping-assignment.onrender.com)**
Fully responsive and works on both desktop and mobile browsers.

---

## Features

### Cross-Device Support

* Works on mobile, tablet, and desktop.
* Fully responsive Leaflet map layout.
* Location services and routing function on mobile browsers that support GPS.

---

### Café Mapping (Leaflet + Django API)

* Interactive map using Leaflet and OpenStreetMap tiles.
* Café markers loaded from `/api/cafes_all/`.
* Marker clustering for performance.
* Popup actions:

  * Route to café
  * Show nearby libraries
  * Add/Remove favourite

---

### Favourites System

* Saved in `localStorage` for persistence.
* Favourite cafés appear with a custom heart icon.
* Toggling favourites updates instantly without page reload.

---

### County Filtering

* County polygons loaded from `/api/counties/`.
* Spatial filtering using PostGIS `ST_Within`.
* Dropdown list is autogenerated.
* County layer can be shown or hidden.

---

### Closest Cafés (Spatial Nearest Neighbour)

* User can pick a location or use their device GPS.
* Backend returns nearest cafés using `ST_Distance`.
* Sidebar displays café details with routing buttons.

---

### Radius Search

* User selects radius or defaults to 2000 metres.
* Circular search area drawn on the map.
* Backend returns cafés within that distance using `geometry__distance_lte`.

---

### Library Finder (Overpass API)

* Located inside each café popup.
* Queries Overpass for libraries within 10 km.
* Results appear with a library icon.
* The system identifies the nearest library and automatically generates a route from the café to it.

---

### Routing (Leaflet Routing Machine)

Routes can be generated:

* From the user’s location to a café.
* From a café to its closest library.
  Routes automatically fit the map bounds and replace any existing route.

---

### Live GPS Tracking

* Shows the user’s position in real time.
* Displays an accuracy radius.
* Re-centres the map as the user moves.
* Works on mobile browsers that support location access.

---

### Reset Functionality

Clears:

* Radius search circle
* Routing path
* Library markers
* Temporary layers

Reloads all cafés and resets UI state.

---

## Technology Stack

### Backend

* Django
* Django REST Framework
* PostgreSQL + PostGIS
* Spatial SQL queries (`ST_Within`, `ST_Distance`, etc.)

### Frontend

* Leaflet.js
* Leaflet.markercluster
* Leaflet Routing Machine
* LocalStorage
* Overpass API for external library search

---

## API Endpoints

| Endpoint                                         | Description                                    |
| ------------------------------------------------ | ---------------------------------------------- |
| `/api/cafes_all/`                                | Returns all cafés as GeoJSON FeatureCollection |
| `/api/cafes_in_county/<county>/`                 | Cafés inside a specific county                 |
| `/api/closest_cafes/?lat=X&lng=Y`                | Nearest cafés to a point                       |
| `/api/cafes_within_radius/?lat=X&lng=Y&radius=R` | Cafés within given radius                      |
| `/api/counties/`                                 | County polygons                                |

---

## Setup Instructions (Local Development)

### 1. Install dependencies

```
pip install -r requirements.txt
```

### 2. Create PostgreSQL + PostGIS database

```
createdb coffee_map
psql -d coffee_map -c "CREATE EXTENSION postgis;"
```

### 3. Run migrations

```
python manage.py migrate
```

### 4. Load GIS data

(Your café points and county polygons)

### 5. Start the server

```
python manage.py runserver
```

Open in browser:
`http://127.0.0.1:8000/`

---

## Deployment

The live deployment is hosted on Render:

**[https://webmapping-assignment.onrender.com](https://webmapping-assignment.onrender.com)**

Render automatically builds the Django application and serves static files.
